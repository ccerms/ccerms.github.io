import{c as v}from"./alert.93440aee.js";import{_ as N}from"./CardBoxModal.1a333cdf.js";import{_ as $}from"./FormControl.dbc7ef08.js";import{o as c,k as d,b as a,t as p,B as D,D as x,Q as U,R as f,T as b,r as C,I as j,M as V,F as w,L as y,c as M,u,C as B,P as T,w as k,g as A,U as P,i as E,V as K,a as _}from"./index.02e3cb5b.js";const R={class:"relative image-wrapper w-12 h-12 rounded-full mr-3"},q=a("img",{class:"rounded-full",src:"https://via.placeholder.com/150.png?text=CCERMS",alt:"User profile"},null,-1),F={key:0,class:"absolute top-0 right-0 rounded-full text-white text-xs bg-red-400 px-[0.5rem] py-[0.15rem]"},I={class:"details"},z={__name:"Participant",props:{img:{type:String,default:null},subject:{type:String,default:null},is_active:{type:Boolean,default:!1},count:{type:Number,default:null}},setup(t){const e=t;return(o,n)=>(c(),d("div",{class:x(["recipients flex items-center p-2 mb-3 cursor-pointer hover:bg-slate-100",t.is_active?"bg-slate-100":""])},[a("div",R,[q,e.count>0?(c(),d("span",F,p(e.count),1)):D("",!0)]),a("div",I,[a("h2",{class:x(["name",t.is_active?"font-bold":""])},p(e.subject),3)])],2))}},L=new Pusher("cad4a66c4c2ebed08af7",{cluster:"ap1"}),S=U("messages",{state:()=>({temp_chats:[],chats:[],message:{id:null,subject:"",img:"",participants:[],chats:[]},chat:{subject:"",email:""},conversation:{user:"",body:""}}),actions:{fetch(t){f.get(`${b}api/messages/${t}`).then(e=>{this.chats=e.data,this.temp_chats=this.chats})},createChat(t){return new Promise((e,o)=>{f.post(`${b}api/messages/${t}`,this.chat).then(n=>{this.chats=n.data.chats,this.temp_chats=this.chats,this.chat={subject:"",emai:""},e(n)}).catch(n=>{o(n)})})},selectChat(t){this.message.id=t.chat.id,this.message.subject=t.chat.subject,this.message.img=t.chat.img,this.message.participants=t.chat.participants.filter(e=>e.user.id!==t.auth_id),this.getConversation(t.chat.id)},getConversation(t){f.get(`${b}api/messages/convo/${t}`).then(e=>{this.message.chats=e.data})},createConversation(t){return this.conversation={user:t.user,body:t.body},new Promise((e,o)=>{f.post(`${b}api/messages/convo/${t.id}`,this.conversation).then(n=>{e(n)}).catch(n=>{o(n)})})}}}),H={class:"sidebar w-full md:w-3/12 h-full border-r-2"},O={class:"header overflow-hidden flex items-center h-20 px-2"},Q=a("h1",{class:"font-bold text-3xl mr-2"},"Chats",-1),G={class:"chats h-5/6 overlow-y-auto"},J={__name:"Sidebar",props:{auth_id:{type:Number,default:null},chats:{type:Array,default:[]}},emits:["searchChat","select","newChat"],setup(t,{emit:e}){const o=t,n=S(),i=C(""),g=()=>{e("searchChat",i.value)},h=s=>{L.subscribe(`message.${s.id}`),e("select",{chat:s,auth_id:o.auth_id})},m=()=>{e("newChat")};return(s,l)=>(c(),d("div",H,[a("div",O,[Q,j(a("input",{class:"flex-1 rounded-lg border-transparent focus:border-transparent focus:ring-0",type:"text",placeholder:"Search chat name","onUpdate:modelValue":l[0]||(l[0]=r=>i.value=r),onKeyup:g},null,544),[[V,i.value]])]),a("div",{class:"new-chat w-full"},[a("button",{class:"w-full py-3 border-y-2 hover:font-bold hover:bg-yellow-200",onClick:m},"New Chat")]),a("div",G,[(c(!0),d(w,null,y(t.chats,r=>(c(),M(z,{key:r.id,img:"img.png",subject:r.subject,count:r.count,is_active:u(n).message.id===r.id,onClick:ue=>h(r)},null,8,["subject","count","is_active","onClick"]))),128))])]))}},W={class:"py-1 text-muted text-[10px]"},X={__name:"TextMessage",props:{isSent:Boolean,datetime:{type:String,default:null}},setup(t){const e=t;return(o,n)=>(c(),d("div",{class:x([t.isSent?"text-right":"text-left","py-2 px-3"])},[a("span",{class:x([t.isSent?"bg-yellow-400 text-white rounded-t-lg rounded-l-lg":"bg-slate-300 rounded-t-lg rounded-r-lg","py-2 px-3"])},[B(o.$slots,"default")],2),a("p",W,p(e.datetime),1)],2))}},Y={class:"message-area hidden md:block w-full h-full"},Z={key:0,class:"flex flex-col h-full"},ee={class:"header flex items-center border-b-2 h-20 px-2"},te=a("div",{class:"image-wrapper w-12 h-12 rounded-full mr-3"},[a("img",{class:"rounded-full",src:"https://via.placeholder.com/150.png?text=CCERMS",alt:"User profile"})],-1),se={class:"name font-bold"},ae={class:"convo flex-1 overflow-y-auto border-b-2 h-20 px-5 py-2"},oe={class:"text flex items-center h-20 px-2"},ne=["onKeyup"],le={key:1},re=a("div",{class:"header flex items-center border-b-2 h-20 px-2"},[a("h2",{class:"name font-bold"},"Select Message")],-1),ce=[re],ie={__name:"MessageArea",props:{auth_id:{type:Number,default:null},message:{type:Object,default:null}},emits:["sendMessage","scrollDown"],setup(t,{emit:e}){const o=t,n=S(),i=C("");T(()=>n.message.id,h=>{h!==null&&setTimeout(()=>e("scrollDown"),500)});const g=()=>{if(i.value===""){v("warning","Message required");return}e("sendMessage",{id:o.message.id,body:i.value,user:o.auth_id}),L.bind("message-sent",h=>{n.message.chats=h.message}),i.value="",e("scrollDown")};return(h,m)=>(c(),d("div",Y,[o.message.id?(c(),d("div",Z,[a("div",ee,[te,a("div",null,[a("h2",se,p(o.message.subject),1),(c(!0),d(w,null,y(o.message.participants,s=>(c(),d("p",{key:s.id},p(s.fullname),1))),128))])]),a("div",ae,[(c(!0),d(w,null,y(o.message.chats,s=>(c(),M(X,{key:s.id,isSent:o.auth_id===s.user.id,datetime:s.created_at},{default:k(()=>[A(p(s.body),1)]),_:2},1032,["isSent","datetime"]))),128))]),a("div",oe,[j(a("input",{class:"flex-1 rounded-lg border-transparent focus:border-transparent focus:ring-0",type:"text",placeholder:"Send message...","onUpdate:modelValue":m[0]||(m[0]=s=>i.value=s),onKeyup:P(g,["enter"])},null,40,ne),[[V,i.value]])])])):(c(),d("div",le,ce))]))}},de={class:"flex",style:{height:"calc(100vh - 57px)"}},_e={__name:"Index",setup(t){const e=S(),o=E(),n=K(),i=C(!1);e.fetch(o.user.id);const g=()=>{if(e.message.id!==null){let s=document.querySelector(".convo");s.scrollTop=s.scrollHeight}},h=s=>{e.temp_chats=e.chats.filter(l=>l.subject.toLowerCase().includes(s.toLowerCase()))},m=()=>{if(e.chat.subject==""||e.chat.email==""){v("warning","Field required!");return}n.showLoading=!0,e.createChat(o.user.id).then(s=>{let l=s.data.status==200?"success":"warning";v(l,s.data.message),n.showLoading=!1}).catch(s=>{v("warning","Server error"),n.showLoading=!1})};return(s,l)=>(c(),d(w,null,[_(N,{modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=r=>i.value=r),"large-title":"Create new chat",button:"success",buttonLabel:"Create",onConfirm:m},{default:k(()=>[_($,{modelValue:u(e).chat.subject,"onUpdate:modelValue":l[0]||(l[0]=r=>u(e).chat.subject=r),placeholder:"Enter chat name..."},null,8,["modelValue"]),_($,{modelValue:u(e).chat.email,"onUpdate:modelValue":l[1]||(l[1]=r=>u(e).chat.email=r),placeholder:"Recipient email..."},null,8,["modelValue"])]),_:1},8,["modelValue"]),a("div",de,[_(J,{auth_id:u(o).user.id,chats:u(e).temp_chats,onSearchChat:h,onSelect:u(e).selectChat,onNewChat:l[3]||(l[3]=r=>i.value=!0)},null,8,["auth_id","chats","onSelect"]),_(ie,{auth_id:u(o).user.id,message:u(e).message,onSendMessage:u(e).createConversation,onScrollDown:g},null,8,["auth_id","message","onSendMessage"])])],64))}};export{_e as default};
